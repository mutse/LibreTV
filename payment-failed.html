<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>支付失败 - LibreTV</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
  <div class="max-w-md w-full mx-4">
    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
      <!-- 失败图标 -->
      <div class="mb-6">
        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto">
          <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </div>
      </div>
      
      <!-- 标题 -->
      <h1 class="text-2xl font-bold text-gray-900 mb-4">支付失败</h1>
      
      <!-- 错误消息 -->
      <div id="error-info" class="mb-6">
        <p class="text-gray-600 mb-4">
          很抱歉，您的支付未能成功完成。
        </p>
        <div id="error-reason" class="bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-700 hidden">
          <strong>失败原因：</strong>
          <span id="reason-text"></span>
        </div>
      </div>
      
      <!-- 建议解决方案 -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left">
        <h3 class="font-medium text-blue-900 mb-2">解决建议：</h3>
        <ul class="text-sm text-blue-800 space-y-1">
          <li>• 检查支付宝账户余额是否充足</li>
          <li>• 确认银行卡是否正常可用</li>
          <li>• 检查网络连接是否稳定</li>
          <li>• 稍后重试或联系客服</li>
        </ul>
      </div>
      
      <!-- 按钮 -->
      <div class="space-y-3">
        <button onclick="retryPayment()" 
                class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
          重新支付
        </button>
        
        <button onclick="goToHome()" 
                class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
          返回首页
        </button>
        
        <button onclick="contactSupport()" 
                class="w-full text-blue-600 hover:text-blue-800 py-2 px-4 transition-colors">
          联系客服
        </button>
      </div>
    </div>
    
    <!-- LibreTV Logo -->
    <div class="text-center mt-8">
      <h2 class="text-lg font-semibold text-gray-700">LibreTV</h2>
      <p class="text-sm text-gray-500">免费在线视频搜索与观看平台</p>
    </div>
  </div>

  <script>
    // 从URL参数获取错误信息
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        reason: params.get('reason'),
        order: params.get('order'),
        message: params.get('message')
      };
    }
    
    // 显示错误信息
    function displayErrorInfo() {
      const params = getUrlParams();
      
      if (params.reason) {
        const errorReason = document.getElementById('error-reason');
        const reasonText = document.getElementById('reason-text');
        
        let reasonMessage = '';
        switch (params.reason) {
          case 'signature_invalid':
            reasonMessage = '支付签名验证失败';
            break;
          case 'processing_error':
            reasonMessage = '支付处理过程中出现错误';
            break;
          case 'payment_cancelled':
            reasonMessage = '支付已被取消';
            break;
          case 'payment_timeout':
            reasonMessage = '支付超时';
            break;
          case 'insufficient_balance':
            reasonMessage = '账户余额不足';
            break;
          default:
            reasonMessage = params.message || '未知错误';
        }
        
        reasonText.textContent = reasonMessage;
        errorReason.classList.remove('hidden');
      }
    }
    
    // 重新支付
    function retryPayment() {
      // 返回订阅页面重新选择支付
      window.location.href = '/?showSubscription=true';
    }
    
    // 返回首页
    function goToHome() {
      window.location.href = '/';
    }
    
    // 联系客服
    function contactSupport() {
      // 这里可以集成在线客服系统或者显示联系方式
      alert('客服联系方式：\n邮箱：support@libretv.com\n工作时间：9:00-18:00');
    }
    
    // 页面加载时显示错误信息
    document.addEventListener('DOMContentLoaded', displayErrorInfo);
  </script>
</body>
</html>